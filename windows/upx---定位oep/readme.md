# upx---定位oep

## 方法1-esp定律   
在编写加壳软件时，必须遵守栈平衡原理。  
将整个外壳作为一个函数或子程序来理解，执行前后遵守栈平衡原理，当其跳转到OEP时，esp的值不会变，这就是esp定律。  
可利用这一特性找到部分加壳软件的OEP。  

流程  
1. 执行压栈，32位程序是`pushad`，64位程序是 `push rbx`  
2. 单击esp寄存器的值，右键转到内存，然后右键设置硬件断点  
3. F9运行，程序断下后，下面的第一条jmp就是跳转到oep  


## 方法2-特殊指令定位
upx壳跳转oep指令的附近可以找到全局唯一的特征指令。  
32位搜指令 `popad`  
64位搜指令 `sub rsp,0xFFFFFFFFFFFFFF80`  
搜到对应指令，下面的第一条jmp就是跳转到oep  


2020/8/11  
