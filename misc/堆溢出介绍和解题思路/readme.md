# 堆溢出介绍和解题思路

## 介绍
堆溢出是指程序向某个堆块中写入的字节数超过了堆块本身可使用的字节数（之所以是可使用而不是用户申请的字节数，是因为堆管理器会对用户所申请的字节数进行调整，这也导致可利用的字节数都不小于用户申请的字节数），因而导致了数据溢出，并覆盖到物理相邻的高地址的下一个堆块。不难发现，堆溢出漏洞发生的基本前提是：  
1. 程序向堆上写入数据
2. 写入的数据大小没有被良好地控制

## 利用策略
一般来说，我们利用堆溢出的策略是：  
a. 覆盖与其物理相邻的下一个chunk的内容  
b. 利用堆中的机制（如 unlink 等）来实现任意地址写入（Write-Anything-Anywhere）或控制堆块中的内容等效果，从而来控制程序的执行流  

比如将要执行的普通函数替换成system的地址，  
参数传入任意命令，就可以执行任意命令，  
参数传入"/bin/sh"，就可以getshell  

## 解题技巧
1. 先跟踪程序中某一堆块的申请、使用、释放的过程。
2. 仔细分析堆块mem区域的数据（是否有函数指针等）。
3. 搞清楚程序中对于堆块的管理方式。
4. 先找对于堆块的写入有没有溢出。
5. 再看释放堆块的函数中，是否有UAF。
6. 采用对应的利用方法去利用。


---
2019/9/13  
